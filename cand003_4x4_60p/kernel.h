// This file automatically generated by template-converter
// DO NOT EDIT!

const char *kern =
"#pragma OPENCL EXTENSION cl_amd_printf : enable\n"
"\n"
"//HARDCODE ALL OF THESE!\n"
"#define N_ANT  256u  //2560u\n"
"#define N_BLK   36u  //3240u // N(N+1)/2 where N=(N_ANT/32)\n"
"#define N_ANT_4 64u  //640u  // N/4\n"
"\n"
"\n"
"\n"
"__kernel void corr(__global uint *packed,\n"
"	           __global  int *corr_buf,\n"
"		   __global uint *id_x_map,\n"
"		   __global uint *id_y_map,\n"
"		   __local  uint *unpacked)\n"
"{\n"
"  uint lx = get_local_id(0);\n"
"  uint ly = get_local_id(1);\n"
"\n"
"  uint z = get_global_id(2) / N_BLK;\n"
"  uint blkid = get_global_id(2) - z*N_BLK;\n"
"  uint x = id_x_map[get_global_id(2)-z*N_BLK];\n"
"  uint y = id_y_map[get_global_id(2)-z*N_BLK];\n"
"\n"
"  uint addr_x = ((get_local_size(0)*x+lx)*4  + z*N_ANT*256) / 4;\n"
"  uint addr_y = ((y*32 + get_global_id(1)*4) + z*N_ANT*256 + lx*N_ANT)/4;\n"
"  if ((lx==0) && (ly==0)) {printf(\"%i %i | %i %i\\n\",lx,ly,x,y);}\n"
"\n"
"  uint corr_a[4]={0,0,0,0};\n"
"  uint corr_b[4]={0,0,0,0};\n"
"  uint corr_c[4]={0,0,0,0};\n"
"  uint corr_d[4]={0,0,0,0};\n"
"  uint corr_e[4]={0,0,0,0};\n"
"  uint corr_f[4]={0,0,0,0};\n"
"  uint corr_g[4]={0,0,0,0};\n"
"  uint corr_h[4]={0,0,0,0};\n"
"\n"
"  for (uint i=0; i<256; i+=get_local_size(0))\n"
"  {\n"
"    uint la=(lx*32 + ly*4);\n"
"    uint pa=packed[mad24(i,N_ANT_4,addr_y)];\n"
"\n"
"    barrier(CLK_LOCAL_MEM_FENCE);\n"
"    unpacked[la]   = (((pa >>  0) & 0xf) << 16) + ((pa >>  4) & 0xf);\n"
"    unpacked[la+1] = (((pa >>  8) & 0xf) << 16) + ((pa >> 12) & 0xf);\n"
"    unpacked[la+2] = (((pa >> 16) & 0xf) << 16) + ((pa >> 20) & 0xf);\n"
"    unpacked[la+3] = (((pa >> 24) & 0xf) << 16) + ((pa >> 28) & 0xf);\n"
"    barrier(CLK_LOCAL_MEM_FENCE);\n"
"\n"
"    for (uint j=0; j<get_local_size(0); j++)\n"
"    {\n"
"      uint temp_ua = unpacked[j*32+ly*4];\n"
"      uint temp_ub = unpacked[j*32+ly*4+1];\n"
"      uint temp_uc = unpacked[j*32+ly*4+2];\n"
"      uint temp_ud = unpacked[j*32+ly*4+3];\n"
"\n"
"      uint temp_par = (packed[addr_x+(i+j)*N_ANT_4] >>  0) & 0xf;\n"
"      uint temp_pai = (packed[addr_x+(i+j)*N_ANT_4] >>  4) & 0xf;\n"
"      uint temp_pbr = (packed[addr_x+(i+j)*N_ANT_4] >>  8) & 0xf;\n"
"      uint temp_pbi = (packed[addr_x+(i+j)*N_ANT_4] >> 12) & 0xf;\n"
"\n"
"      uint temp_pcr = (packed[addr_x+(i+j)*N_ANT_4] >> 16) & 0xf;\n"
"      uint temp_pci = (packed[addr_x+(i+j)*N_ANT_4] >> 20) & 0xf;\n"
"      uint temp_pdr = (packed[addr_x+(i+j)*N_ANT_4] >> 24) & 0xf;\n"
"      uint temp_pdi = (packed[addr_x+(i+j)*N_ANT_4] >> 28) & 0xf;\n"
"\n"
"      corr_a[0]=mad24(temp_par, temp_ua, corr_a[0]);\n"
"      corr_a[1]=mad24(temp_pai, temp_ua, corr_a[1]);\n"
"      corr_a[2]=mad24(temp_pbr, temp_ua, corr_a[2]);\n"
"      corr_a[3]=mad24(temp_pbi, temp_ua, corr_a[3]);\n"
"\n"
"      corr_b[0]=mad24(temp_par, temp_ub, corr_b[0]);\n"
"      corr_b[1]=mad24(temp_pai, temp_ub, corr_b[1]);\n"
"      corr_b[2]=mad24(temp_pbr, temp_ub, corr_b[2]);\n"
"      corr_b[3]=mad24(temp_pbi, temp_ub, corr_b[3]);\n"
"\n"
"      corr_c[0]=mad24(temp_par, temp_uc, corr_c[0]);\n"
"      corr_c[1]=mad24(temp_pai, temp_uc, corr_c[1]);\n"
"      corr_c[2]=mad24(temp_pbr, temp_uc, corr_c[2]);\n"
"      corr_c[3]=mad24(temp_pbi, temp_uc, corr_c[3]);\n"
"\n"
"      corr_d[0]=mad24(temp_par, temp_ud, corr_d[0]);\n"
"      corr_d[1]=mad24(temp_pai, temp_ud, corr_d[1]);\n"
"      corr_d[2]=mad24(temp_pbr, temp_ud, corr_d[2]);\n"
"      corr_d[3]=mad24(temp_pbi, temp_ud, corr_d[3]);\n"
"\n"
"\n"
"      corr_e[0]=mad24(temp_pcr, temp_ua, corr_e[0]);\n"
"      corr_e[1]=mad24(temp_pci, temp_ua, corr_e[1]);\n"
"      corr_e[2]=mad24(temp_pdr, temp_ua, corr_e[2]);\n"
"      corr_e[3]=mad24(temp_pdi, temp_ua, corr_e[3]);\n"
"\n"
"      corr_f[0]=mad24(temp_pcr, temp_ub, corr_f[0]);\n"
"      corr_f[1]=mad24(temp_pci, temp_ub, corr_f[1]);\n"
"      corr_f[2]=mad24(temp_pdr, temp_ub, corr_f[2]);\n"
"      corr_f[3]=mad24(temp_pdi, temp_ub, corr_f[3]);\n"
"\n"
"      corr_g[0]=mad24(temp_pcr, temp_uc, corr_g[0]);\n"
"      corr_g[1]=mad24(temp_pci, temp_uc, corr_g[1]);\n"
"      corr_g[2]=mad24(temp_pdr, temp_uc, corr_g[2]);\n"
"      corr_g[3]=mad24(temp_pdi, temp_uc, corr_g[3]);\n"
"\n"
"      corr_h[0]=mad24(temp_pcr, temp_ud, corr_h[0]);\n"
"      corr_h[1]=mad24(temp_pci, temp_ud, corr_h[1]);\n"
"      corr_h[2]=mad24(temp_pdr, temp_ud, corr_h[2]);\n"
"      corr_h[3]=mad24(temp_pdi, temp_ud, corr_h[3]);\n"
"    }\n"
"  }\n"
"\n"
"  uint addr_o = ((blkid * 1024) + (get_global_id(1) * 4 * 32) + (lx * 4)) * 2;\n"
"\n"
"  atomic_add(&corr_buf[addr_o],   (corr_a[0] >> 16) + (corr_a[1] & 0xffff) );\n"
"  atomic_add(&corr_buf[addr_o+1], (corr_a[1] >> 16) - (corr_a[0] & 0xffff) );\n"
"  atomic_add(&corr_buf[addr_o+2], (corr_a[2] >> 16) + (corr_a[3] & 0xffff) );\n"
"  atomic_add(&corr_buf[addr_o+3], (corr_a[3] >> 16) - (corr_a[2] & 0xffff) );\n"
"\n"
"  atomic_add(&corr_buf[addr_o+64], (corr_b[0] >> 16) + (corr_b[1] & 0xffff) );\n"
"  atomic_add(&corr_buf[addr_o+65], (corr_b[1] >> 16) - (corr_b[0] & 0xffff) );\n"
"  atomic_add(&corr_buf[addr_o+66], (corr_b[2] >> 16) + (corr_b[3] & 0xffff) );\n"
"  atomic_add(&corr_buf[addr_o+67], (corr_b[3] >> 16) - (corr_b[2] & 0xffff) );\n"
"\n"
"  atomic_add(&corr_buf[addr_o+128], (corr_c[0] >> 16) + (corr_c[1] & 0xffff) );\n"
"  atomic_add(&corr_buf[addr_o+129], (corr_c[1] >> 16) - (corr_c[0] & 0xffff) );\n"
"  atomic_add(&corr_buf[addr_o+130], (corr_c[2] >> 16) + (corr_c[3] & 0xffff) );\n"
"  atomic_add(&corr_buf[addr_o+131], (corr_c[3] >> 16) - (corr_c[2] & 0xffff) );\n"
"\n"
"  atomic_add(&corr_buf[addr_o+192], (corr_d[0] >> 16) + (corr_d[1] & 0xffff) );\n"
"  atomic_add(&corr_buf[addr_o+193], (corr_d[1] >> 16) - (corr_d[0] & 0xffff) );\n"
"  atomic_add(&corr_buf[addr_o+194], (corr_d[2] >> 16) + (corr_d[3] & 0xffff) );\n"
"  atomic_add(&corr_buf[addr_o+195], (corr_d[3] >> 16) - (corr_d[2] & 0xffff) );\n"
"\n"
"\n"
"  atomic_add(&corr_buf[addr_o+4], (corr_e[0] >> 16) + (corr_e[1] & 0xffff) );\n"
"  atomic_add(&corr_buf[addr_o+5], (corr_e[1] >> 16) - (corr_e[0] & 0xffff) );\n"
"  atomic_add(&corr_buf[addr_o+6], (corr_e[2] >> 16) + (corr_e[3] & 0xffff) );\n"
"  atomic_add(&corr_buf[addr_o+7], (corr_e[3] >> 16) - (corr_e[2] & 0xffff) );\n"
"\n"
"  atomic_add(&corr_buf[addr_o+68], (corr_f[0] >> 16) + (corr_f[1] & 0xffff) );\n"
"  atomic_add(&corr_buf[addr_o+69], (corr_f[1] >> 16) - (corr_f[0] & 0xffff) );\n"
"  atomic_add(&corr_buf[addr_o+70], (corr_f[2] >> 16) + (corr_f[3] & 0xffff) );\n"
"  atomic_add(&corr_buf[addr_o+71], (corr_f[3] >> 16) - (corr_f[2] & 0xffff) );\n"
"\n"
"  atomic_add(&corr_buf[addr_o+132], (corr_g[0] >> 16) + (corr_g[1] & 0xffff) );\n"
"  atomic_add(&corr_buf[addr_o+133], (corr_g[1] >> 16) - (corr_g[0] & 0xffff) );\n"
"  atomic_add(&corr_buf[addr_o+134], (corr_g[2] >> 16) + (corr_g[3] & 0xffff) );\n"
"  atomic_add(&corr_buf[addr_o+135], (corr_g[3] >> 16) - (corr_g[2] & 0xffff) );\n"
"\n"
"  atomic_add(&corr_buf[addr_o+196], (corr_h[0] >> 16) + (corr_h[1] & 0xffff) );\n"
"  atomic_add(&corr_buf[addr_o+197], (corr_h[1] >> 16) - (corr_h[0] & 0xffff) );\n"
"  atomic_add(&corr_buf[addr_o+198], (corr_h[2] >> 16) + (corr_h[3] & 0xffff) );\n"
"  atomic_add(&corr_buf[addr_o+199], (corr_h[3] >> 16) - (corr_h[2] & 0xffff) );\n"
"}\n"
;

