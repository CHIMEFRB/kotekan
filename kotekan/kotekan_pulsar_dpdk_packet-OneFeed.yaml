---
type: config
log_level: 3
udp_packet_size: 4928
udp_pulsar_packet_size: 6288
udp_pulsar_header_size: 32
num_links: 4
timesamples_per_packet: 2
timesamples_per_pulsar_packet: 3125
upd_pulsar_packet_in_stream: 16
num_elements: 2048
num_local_freq: 1
num_total_freq: 4
num_pulsar: 10
num_pol: 2
psr-test_one_feed_one_pol: 0   #Cylinder A, centre feed, pol 0
samples_per_data_set: 49152
num_data_sets: 1
buffer_depth: 3
num_gpu_frames: 1
num_gpus: 4
cpu_affinity: [0,1,2,3,4,5,6,7,8,9,10,11]
sizeof_float: 4

# Pool
main_pool:
    kotekan_metadata_pool: chimeMetadata
    num_metadata_objects: 5 * buffer_depth

# Buffers
gpu_input_buffers:
    num_frames: buffer_depth
    frame_size: samples_per_data_set * num_elements * num_local_freq * num_data_sets
    metadata_pool: main_pool
    gpu_input_buffer_0:
        kotekan_buffer: standard
    gpu_input_buffer_1:
        kotekan_buffer: standard
    gpu_input_buffer_2:
        kotekan_buffer: standard
    gpu_input_buffer_3:
        kotekan_buffer: standard

pulsar_beamform_output_buffesrs:
    num_frames: buffer_depth
    frame_size: samples_per_data_set * num_pulsar * num_pol 
    metadata_pool: main_pool
    pulsar_beamform_output_buffer_0:
        kotekan_buffer: standard
    pulsar_beamform_output_buffer_1:
        kotekan_buffer: standard
    pulsar_beamform_output_buffer_2:
        kotekan_buffer: standard
    pulsar_beamform_output_buffer_3:
        kotekan_buffer: standard

pulsar_output_buffer:
    num_frames: buffer_depth
    frame_size: udp_pulsar_packet_size* num_pulsar * num_gpus * upd_pulsar_packet_in_stream
    metadata_pool: main_pool
    kotekan_buffer: standard

dpdk:
  kotekan_process: dpdkWrapper
  mode: shuffle4
  num_lcores: 4
  link_map: [0,1,2,3]
  network_out_buf_0: gpu_input_buffer_0
  network_out_buf_1: gpu_input_buffer_1
  network_out_buf_2: gpu_input_buffer_2
  network_out_buf_3: gpu_input_buffer_3

gpu:
  commands:
  - name: hsa_input_data
    kernel: ''
  - name: hsa_barrier
    kernel: ''
  - name: hsa_beamform_pulsar_one_feed
    kernel: "../lib/hsa/kernels/pulsar_beamformer.hsaco"
  - name: hsa_beamform_output
    kernel: ''
  link_map: [0,1,2,3]
  num_gpus: 4
  block_size: 32
  buffer_depth: 3
  gpu_0:
    kotekan_process: hsaProcess
    gpu_id: 0
    network_buffer: gpu_input_buffer_0
    output_buffer: pulsar_beamform_output_buffer_0
  gpu_1:
    kotekan_process: hsaProcess
    gpu_id: 1
    network_buffer: gpu_input_buffer_1
    output_buffer: pulsar_beamform_output_buffer_1
  gpu_2:
    kotekan_process: hsaProcess
    gpu_id: 2
    network_buffer: gpu_input_buffer_2
    output_buffer: pulsar_beamform_output_buffer_2
  gpu_3:
    kotekan_process: hsaProcess
    gpu_id: 3
    network_buffer: gpu_input_buffer_3
    output_buffer: pulsar_beamform_output_buffer_3

postprocess:
  kotekan_process: pulsarPostProcess
  network_input_buffer_0: pulsar_beamform_output_buffer_0
  network_input_buffer_1: pulsar_beamform_output_buffer_1
  network_input_buffer_2: pulsar_beamform_output_buffer_2
  network_input_buffer_3: pulsar_beamform_output_buffer_3
  pulsar_out_buf: pulsar_output_buffer

hex_dump:
  kotekan_process: hexDump
  buf: pulsar_output_buffer
  len: 128
  offset: 0