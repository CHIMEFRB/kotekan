---
type: config
system:
  #mode: gpu_test
  mode: pathfinder
  log_level: 3
#Have to duplicate num_elements and num_local_freq for now. Makes testing easier.
#Eventually, remove all references to "adjusted" in code.
num_elements: 256
num_adjusted_elements: 256
num_local_freq: 8
num_adjusted_local_freq: 8
num_total_freq: 64
#num_adjusted_elements/block_size * (num_adjusted_elements/block_size + 1)/2; block_size = 32.
num_blocks: 36
block_size: 32
samples_per_data_set: 32768
num_data_sets: 1
buffer_depth: 8
num_gpu_frames: 64
num_links: 8
link_map: [0,0,1,1,1,2,2,2]
num_gpus: 3
cpu_affinity: [4,5,6,7]
enable_gating: false

dpdk:
  kotekan_process: dpdkWrapper
  mode: no_shuffle
  num_lcores: 4
  udp_packet_size: 4800
  timesamples_per_packet: 2
  network_out_buf_0: gpu_input_buffer_0
  network_out_buf_1: gpu_input_buffer_1
  network_out_buf_2: gpu_input_buffer_2

# Comment out gpu_post_process if running with this test
#gen_data:
#  type: const
#  value: 153
#  test_data_gen_0:
#    kotekan_process: testDataGen
#    network_out_buf: gpu_input_buffer_0
#  test_data_gen_0:
#    kotekan_process: testDataGen
#    network_out_buf: gpu_input_buffer_1
#  test_data_gen_0:
#    kotekan_process: testDataGen
#    network_out_buf: gpu_input_buffer_2

gpu:
  commands:
  - name: input_data_stage
    kernel: ''
  - name: offset_accumulator
    kernel: "../lib/opencl/kernels/offset_accumulator.cl"
  - name: preseed_multifreq
    kernel: "../lib/opencl/kernels/preseed_multifreq.cl"
  - name: pairwise_correlator
    kernel: "../lib/opencl/kernels/pairwise_correlator.cl"    
  - name: output_data_result
    kernel: ''
  ts_element_offset: 0
  ts_num_elem_to_shift: 0
  ts_samples_to_shift: 0
  use_timeshift: 0
  enable_beamforming: false
  use_incoh_beamforming: 0
  gpu_0:
    kotekan_process: clProcess
    gpu_id: 0
    network_buffer: gpu_input_buffer_0
    output_buffer: gpu_output_buffer_0
  gpu_1:
    kotekan_process: clProcess
    gpu_id: 1
    network_buffer: gpu_input_buffer_1
    output_buffer: gpu_output_buffer_1
  gpu_2:
    kotekan_process: clProcess
    gpu_id: 2
    network_buffer: gpu_input_buffer_2
    output_buffer: gpu_output_buffer_2

# Remove from production
# Comment out gpu_post_process if running with this test
#check_data:
#  real: 0
#  imag: 65536
#  const_data_check_0:
#    kotekan_process: constDataCheck
#    buf: gpu_output_buffer_0
#  const_data_check_1:
#    kotekan_process: constDataCheck
#    buf: gpu_output_buffer_1
#  const_data_check_2:
#    kotekan_process: constDataCheck
#    buf: gpu_output_buffer_2

gpu_post_process:
    kotekan_process: gpuPostProcess
    gate_cadence: 1
    gate_phase: 0
    product_remap: [92,  93,  94,  95,  88,  89,  90,  91,  84,  85,  86,  87,  80,  81,  82,  83,  28,  29,  30,  31,  24,  25,  26,  27,  20,  21,  22,  23,  16,  17,  18,  19,  76,  77,  78,  79,  72,  73,  74,  75,  68,  69,  70,  71,  64,  65,  66,  67,  12,  13,  14,  15,  8,  9,  10,  11,  4,  5,  6,  7,  0,  1,  2,  3,  220,  221,  222,  223,  216,  217,  218,  219,  212,  213,  214,  215,  208,  209,  210,  211,  156,  157,  158,  159,  152,  153,  154,  155,  148,  149,  150,  151,  144,  145,  146,  147,  204,  205,  206,  207,  200,  201,  202,  203,  196,  197,  198,  199,  192,  193,  194,  195,  140,  141,  142,  143,  136,  137,  138,  139,  132,  133,  134,  135,  128,  129,  130,  131,  252,  253,  254,  255,  248,  249,  250,  251,  244,  245,  246,  247,  240,  241,  242,  243,  188,  189,  190,  191,  184,  185,  186,  187,  180,  181,  182,  183,  176,  177,  178,  179,  236,  237,  238,  239,  232,  233,  234,  235,  228,  229,  230,  231,  224,  225,  226,  227,  172,  173,  174,  175,  168,  169,  170,  171,  164,  165,  166,  167,  160,  161,  162,  163,  124,  125,  126,  127,  120,  121,  122,  123,  116,  117,  118,  119,  112,  113,  114,  115,  60,  61,  62,  63,  56,  57,  58,  59,  52,  53,  54,  55,  48,  49,  50,  51,  108,  109,  110,  111,  104,  105,  106,  107,  100,  101,  102,  103,  96,  97,  98,  99,  44,  45,  46,  47,  40,  41,  42,  43,  36,  37,  38,  39,  32,  33,  34,  35]
    corr_in_buf_0: gpu_output_buffer_0
    corr_in_buf_1: gpu_output_buffer_1
    corr_in_buf_2: gpu_output_buffer_2
    chrx_out_buf: network_output_buffer
    gate_out_buf: gated_output_buffer

#chrxUplink:
#    collection_server_ip: "127.0.0.1"
#    collection_server_port: 41001
#    chrx_in_buf: network_output_buffer
#    gate_in_buf: gated_output_buffer
#nullProcess used when disable upload is true and chrxUplink should not be active.

null_0:
  kotekan_process: nullProcess
  in_buf: network_output_buffer
null_1:
  kotekan_process: nullProcess
  in_buf: gated_output_buffer

buffer_status:
  kotekan_process: bufferStatus
  time_delay: 30000 #microseconds
