---
type: config
log_level: 3

instrument_name: aro

integration_length: 16384
num_freq: 1024
num_local_freq: 1024
num_elements: 2
samples_per_data_set: 65536
#samples_per_data_set: 32768
buffer_depth: 1
num_links: 8
timesamples_per_packet: 2
cpu_affinity: [8,9,10,11]
vdif_header_size: 64

meta_pool:
  kotekan_metadata_pool: chimeMetadata
  num_metadata_objects: 5 * num_disks * buffer_depth

vdif_input_buf_0:
  kotekan_buffer: standard
  metadata_pool: meta_pool
  num_frames: buffer_depth * num_disks
  frame_size: samples_per_data_set * num_elements * (num_freq + vdif_header_size)

gpu_output_buffer_0:
  kotekan_buffer: standard
  metadata_pool: meta_pool
  num_frames: buffer_depth * num_disks
  frame_size: samples_per_data_set * num_elements * (num_freq + vdif_header_size)

output_power_buf:
  kotekan_buffer: standard
  metadata_pool: meta_pool
  num_frames: buffer_depth
  sizeof_float: 4
  frame_size: (samples_per_data_set/integration_length) * (num_freq + 1) * num_elements * sizeof_float

replay:
  kotekan_process: nDiskFileRead
  num_disks: 10
  disk_base: /mnt/
  disk_set: A
  out_buf: vdif_input_buf_0
  capture: 20170426T110023Z_ARO_raw
  sk_step: 16384
  rfi: False
  rfi_sensitivity: 3
  normalize: True

raw_capture:
  kotekan_process: nDiskFileWrite
  write_to_disk: false
  gain_files:
  - /home/squirrel/ch_acq/gains_slotNone.pkl
  - /home/squirrel/ch_acq/gains_noisy_slotNone.pkl
  gain_file_dir: /tmp
  num_disks: 10
  disk_base: /drives/
  disk_set: testing
  in_buf: vdif_input_buf_0

gpu:
  commands:
  - name: hsa_input_data
    kernel: ''
  - name: hsa_barrier
    kernel: ''
  - name: hsa_rfi_vdif
    kernel: "../lib/hsa/kernels/rfi_vdif.hsaco"
  - name: hsa_rfi_output
    kernel: ''
  link_map: [0,1,2,3]
  num_gpus: 1
  block_size: 32
  buffer_depth: 4
  sk_step: 8192
  rfi_sensitivity: 5
  gpu_0:
    kotekan_process: hsaProcess
    gpu_id: 0
    network_buffer: vdif_input_buf_0
    output_buffer: gpu_output_buffer_0

power:
  kotekan_process: computeDualpolPower
  rfi_removal: False
  rfi_sensitivity: 3
  rfi_backfill: False
  vdif_in_buf: gpu_output_buffer_0
  power_out_buf: output_power_buf

network_stream:
  kotekan_process: networkPowerStream
  power_in_buf: output_power_buf
  destination_port: 2051
  destination_ip: 127.0.0.1
  destination_protocol: TCP
