---
type: config
# Logging level can be one of:
# OFF, ERROR, WARN, INFO, DEBUG, DEBUG2 (case insensitive)
# Note DEBUG and DEBUG2 require a build with (-DCMAKE_BUILD_TYPE=Debug)
log_level: info
num_elements: 2048
num_local_freq: 1
num_total_freq: 4
samples_per_data_set: 32768
num_data_sets: 1
buffer_depth: 6
num_gpu_frames: 1
cpu_affinity: [0,1,2,3,4,5,6,7,8,9,10,11]
block_size: 32

rfi_zero: False
sk_step: 256
rfi_sensitivity: 10

# Pool
main_pool:
    kotekan_metadata_pool: chimeMetadata
    num_metadata_objects: 10 * buffer_depth

# Buffers
gpu_input_buffers:
    num_frames: buffer_depth
    frame_size: samples_per_data_set * num_elements * num_local_freq * num_data_sets
    metadata_pool: main_pool
    gpu_input_buffer_0:
        kotekan_buffer: standard
    gpu_input_buffer_1:
        kotekan_buffer: standard
    gpu_input_buffer_2:
        kotekan_buffer: standard
    gpu_input_buffer_3:
        kotekan_buffer: standard

gpu_output_buffers:
    num_frames: buffer_depth
    frame_size: 4 * num_data_sets * num_local_freq * ((num_elements * num_elements) + (num_elements * block_size))
    metadata_pool: main_pool
    gpu_output_buffer_0:
        kotekan_buffer: standard
    gpu_output_buffer_1:
        kotekan_buffer: standard
    gpu_output_buffer_2:
        kotekan_buffer: standard
    gpu_output_buffer_3:
        kotekan_buffer: standard

# Processes
gen_data:
  type: const
  value: 153
  test_data_gen_0:
    kotekan_process: testDataGen
    network_out_buf: gpu_input_buffer_0
  test_data_gen_1:
    kotekan_process: testDataGen
    network_out_buf: gpu_input_buffer_1
  test_data_gen_2:
    kotekan_process: testDataGen
    network_out_buf: gpu_input_buffer_2
  test_data_gen_3:
    kotekan_process: testDataGen
    network_out_buf: gpu_input_buffer_3

gpu:
  commands:
  - name: hsa_input_data
    kernel: ''
  - name: hsa_presum_zero
    kernel: ''
  - name: hsa_output_data_zero
    kernel: ''
  - name: hsa_barrier
    kernel: ''
  - name: hsa_rfi
    kernel: "../lib/hsa/kernels/rfi_chime.hsaco"
  - name: hsa_preseed_kernel
    kernel: "../lib/hsa/kernels/presum.hsaco"
  - name: hsa_correlator_kernel
    kernel: "../lib/hsa/kernels/N2.hsaco"
  - name: hsa_output_data
    kernel: ''
  link_map: [0,1,2,3]
  num_gpus: 4
  buffer_depth: 4
  # Internal N^2 kernel parameter, only needed for N2.hsaco
  n_intg: 16384
  frame_arrival_period: samples_per_data_set / 390625
  log_profiling: true
  gpu_0:
    kotekan_process: hsaProcess
    gpu_id: 0
    in_buffers:
      network_buf: gpu_input_buffer_0
    out_buffers:
      output_buf: gpu_output_buffer_0
  gpu_1:
    kotekan_process: hsaProcess
    gpu_id: 1
    in_buffers:
      network_buf: gpu_input_buffer_1
    out_buffers:
      output_buf: gpu_output_buffer_1
  gpu_2:
    kotekan_process: hsaProcess
    gpu_id: 2
    in_buffers:
      network_buf: gpu_input_buffer_2
    out_buffers:
      output_buf: gpu_output_buffer_2
  gpu_3:
    kotekan_process: hsaProcess
    gpu_id: 3
    in_buffers:
      network_buf: gpu_input_buffer_3
    out_buffers:
      output_buf: gpu_output_buffer_3

check_data:
  real: 65536
  imag: 0
  log_level: WARN
  const_data_check_0:
    kotekan_process: constDataCheck
    buf: gpu_output_buffer_0
  const_data_check_1:
    kotekan_process: constDataCheck
    buf: gpu_output_buffer_1
  const_data_check_2:
    kotekan_process: constDataCheck
    buf: gpu_output_buffer_2
  const_data_check_3:
    kotekan_process: constDataCheck
    buf: gpu_output_buffer_3
